blueprint:
  name: ESPHome Speaker
  description: >
    ESPHome Speaker – Phát âm thanh thông báo, cảnh báo
  domain: automation

  input:
    trigger_event:
      name: Điều kiện kích hoạt
      selector:
        trigger:

    speaker:
      name: Speaker
      selector:
        entity:
          domain: media_player

    volume:
      name: Volume
      default: 1
      selector:
        number:
          min: 0
          max: 1
          step: 0.05
          mode: slider

    sound_name:
      name: Chọn âm báo
      default: Bell
      selector:
        select:
          options:
            - Bell
            - Chime
            - Alarm
            - Notify

    auto_stop:
      name: Tự dừng âm thanh sau (s)
      default: 5
      selector:
        number:
          min: 0
          max: 60
          step: 1

mode: restart

# ⭐ DÒNG QUAN TRỌNG NHẤT
trigger: !input trigger_event

action:
  - variables:
      selected_sound: >
        {% if sound_name == 'Bell' %}
          https://raw.githubusercontent.com/nguyenho/speaker-sounds/main/bell.mp3
        {% elif sound_name == 'Chime' %}
          https://raw.githubusercontent.com/nguyenho/speaker-sounds/main/chime.mp3
        {% elif sound_name == 'Alarm' %}
          https://raw.githubusercontent.com/hoducnguyenhd/ha-blueprints/main/blueprints/sounds/alarm.wav
        {% elif sound_name == 'Notify' %}
          https://raw.githubusercontent.com/nguyenho/speaker-sounds/main/notify.mp3
        {% endif %}

  - service: media_player.volume_set
    target:
      entity_id: !input speaker
    data:
      volume_level: !input volume

  - service: media_player.play_media
    target:
      entity_id: !input speaker
    data:
      media_content_id: "{{ selected_sound }}"
      media_content_type: music

  - delay:
      seconds: !input auto_stop

  - service: media_player.stop
    target:
      entity_id: !input speaker
